<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Live Log Viewer</title>
<script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />

<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  min-height:100vh; padding:20px;
}
.container {
  max-width:1200px; margin:0 auto;
  background:white; border-radius:10px;
  box-shadow:0 10px 40px rgba(0,0,0,0.2);
  overflow:hidden; transition:all 0.5s ease;
}
.container.expanded { max-width:1700px; }

.header {
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:white; padding:15px 25px;
  display:flex; align-items:center; justify-content:space-between;
}
.header h1 {
  font-size:1.6em; font-weight:600; margin:0;
  white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
}
.menu {
  position:relative;
  display:none; /* hidden initially */
}
.menu button {
  background:none; border:none; color:white;
  font-size:24px; cursor:pointer;
}
.menu-content {
  display:none;
  position:absolute; right:0; top:40px;
  background:white; border-radius:8px;
  box-shadow:0 8px 25px rgba(0,0,0,0.25);
  min-width:160px; z-index:10;
}
.menu-content.show { display:block; }
.menu-content button {
  display:flex; align-items:center; gap:10px;
  width:100%; border:none; background:none; cursor:pointer;
  padding:10px 15px; font-size:15px; color:#333; transition:background 0.2s;
}
.menu-content button:hover { background:#f2f2f2; }
.menu-content i { width:20px; }

.content { padding:25px; }
.form-group { margin-bottom:20px; }
.form-row { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-bottom:20px; }
.form-row.full { grid-template-columns:1fr; }
label { display:block; margin-bottom:8px; font-weight:600; color:#333; }
input, select {
  width:100%; padding:12px;
  border:2px solid #e0e0e0; border-radius:5px;
  font-size:14px; font-family:'Courier New', monospace;
  transition:border-color 0.3s; background:white;
}
input:focus, select:focus {
  outline:none; border-color:#667eea;
  box-shadow:0 0 0 3px rgba(102,126,234,0.1);
}
.status {
  padding:15px; border-radius:5px; margin-bottom:20px;
  font-weight:600; display:none;
}
.status.show { display:block; }
.status.success { background:#d4edda; color:#155724; border:1px solid #c3e6cb; }
.status.error { background:#f8d7da; color:#721c24; border:1px solid #f5c6cb; }
.status.info { background:#d1ecf1; color:#0c5460; border:1px solid #bee5eb; }

.start-btn {
  margin-top:20px;
  display:flex; justify-content:center;
}
.start-btn button {
  background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  color:white; border:none; border-radius:6px;
  padding:10px 22px; font-size:16px;
  font-weight:600; cursor:pointer;
  transition:transform 0.2s, box-shadow 0.2s;
}
.start-btn button:hover {
  transform:translateY(-2px);
  box-shadow:0 4px 15px rgba(118,75,162,0.3);
}

.log-container {
  background:#1e1e1e; color:#00ff00;
  border-radius:5px; padding:15px;
  height:650px; overflow-y:auto;
  font-family:'Courier New', monospace;
  font-size:13px; line-height:1.5;
  border:2px solid #e0e0e0; margin-top:15px;
  display:none;
}
.log-line { white-space:pre-wrap; word-wrap:break-word; }
.log-container::-webkit-scrollbar { width:8px; }
.log-container::-webkit-scrollbar-track { background:#2d2d2d; border-radius:5px; }
.log-container::-webkit-scrollbar-thumb { background:#667eea; border-radius:5px; }
.log-container::-webkit-scrollbar-thumb:hover { background:#764ba2; }
.info-text { color:#666; font-size:13px; margin-top:10px; }
.hidden { display:none; }
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1 id="headerText">üìä Live Log Viewer</h1>
    <div class="menu" id="menu">
      <button id="menuBtn"><i class="fas fa-bars"></i></button>
      <div class="menu-content" id="menuContent">
        <button id="stopBtn" onclick="stopStreaming()" disabled><i class="fas fa-stop"></i> Stop</button>
        <button id="clearBtn" onclick="clearLogs()"><i class="fas fa-trash"></i> Clear</button>
      </div>
    </div>
  </div>

  <div class="content">
    <div id="status" class="status"></div>

    <div id="inputFields">
      <div class="form-row">
        <div class="form-group">
          <label for="username">Jumphost</label>
          <select id="username">
            <option value="jhnonprodqa">jhnonprodqa</option>
            <option value="jhuat">jhuat</option>
            <option value="jhproductqa">jhproductqa</option>
            <option value="jhmeuat">jhmeuat</option>
          </select>
        </div>
        <div class="form-group">
          <label for="host">Service IP</label>
          <input type="text" id="host" placeholder="e.g., 10.0.0.1" />
        </div>
      </div>

      <div class="form-row full">
        <div class="form-group">
          <label for="log_path">Log File</label>
          <select id="log_path">
            <option value="/var/log/bidgely/ingesterJobs/gbUserDataIngester/gbUserDataIngester.log">IngesterJob Logs</option>
            <option value="/var/log/bidgely/aggregationServices/aggregationMessageProcessor/aggregationMessageProcessor.log">Aggregation Logs</option>
            <option value="/var/log/bidgely/aggregationServices/aggregationMessageProcessorPriority/aggregationMessageProcessorPriority.log">AggregationPriority Logs</option>
            <option value="/var/log/bidgely/pyamidisagg/pydisagg/gb_disagg.log">Disagg Logs</option>
            <option value="/var/log/bidgely/pyamidisagg/pydisaggpriority/gb_disagg.log">DisaggPriority Logs</option>
            <option value="/var/log/bidgely/emailServices/emailer/emailer.log">Emailer Logs</option>
            <option value="/var/log/bidgely/pdfGenerationService/pdfGeneration/pdfGeneration.log">PDFGeneration Logs</option>
          </select>
        </div>
      </div>

      <p class="info-text">üîê Passwords are loaded from .env file for security</p>

      <!-- Start button -->
      <div class="start-btn" id="startSection">
        <button id="startBtn" onclick="startStreaming()"><i class="fas fa-play"></i> Start Streaming</button>
      </div>
    </div>

    <div class="log-container" id="logContainer"></div>
  </div>
</div>

<script>
const socket = io();
let isStreaming = false;

document.getElementById('menuBtn').addEventListener('click', () => {
  document.getElementById('menuContent').classList.toggle('show');
});

socket.on('connect', () => showStatus('Connected to server', 'success'));
socket.on('connected', (data) => {
  showStatus(data.message, 'success');
  isStreaming = true;
  updateButtons();

  // Hide input fields and Start button
  document.getElementById('inputFields').classList.add('hidden');
  document.getElementById('startSection').classList.add('hidden');

  // Show logs and expand container
  document.getElementById('logContainer').style.display = 'block';
  document.querySelector('.container').classList.add('expanded');

  // Show menu now
  document.getElementById('menu').style.display = 'block';

  const logSelect = document.getElementById('log_path');
  const jumphostSelect = document.getElementById('username');
  const logName = logSelect.options[logSelect.selectedIndex].text;
  const jumphost = jumphostSelect.value;
  document.getElementById('headerText').textContent = 
    `üì° Live logs of ${logName} in ${jumphost}`;
});

socket.on('status', (data) => showStatus(data.message, 'info'));
socket.on('log_data', (data) => {
  const logContainer = document.getElementById('logContainer');
  const logLine = document.createElement('div');
  logLine.className = 'log-line';
  logLine.textContent = data.data;
  logContainer.appendChild(logLine);
  logContainer.scrollTop = logContainer.scrollHeight;
});
socket.on('error', (data) => {
  showStatus(data.message, 'error');
  isStreaming = false;
  updateButtons();
});
socket.on('disconnected', (data) => {
  showStatus(data.message, 'info');
  isStreaming = false;
  updateButtons();

  document.getElementById('inputFields').classList.remove('hidden');
  document.getElementById('startSection').classList.remove('hidden');
  document.getElementById('logContainer').style.display = 'none';
  document.getElementById('menu').style.display = 'none';
  document.getElementById('headerText').textContent = 'üìä Live Log Viewer';
  document.querySelector('.container').classList.remove('expanded');
});

function startStreaming() {
  const jumphost = document.getElementById('username').value.trim();
  const host = document.getElementById('host').value.trim();
  const log_path = document.getElementById('log_path').value.trim();

  if (!jumphost || !host || !log_path) {
    showStatus('Please fill all fields: Jumphost, Host, and Log File', 'error');
    return;
  }
  showStatus('Connecting...', 'info');
  socket.emit('start_streaming', { jumphost, host, log_path });
}
function stopStreaming() { socket.emit('stop_streaming'); }
function clearLogs() {
  document.getElementById('logContainer').innerHTML = '';
  showStatus('Logs cleared', 'info');
}
function showStatus(message, type) {
  const statusDiv = document.getElementById('status');
  statusDiv.textContent = message;
  statusDiv.className = `status show ${type}`;
  if (type === 'success' || type === 'info')
    setTimeout(() => { statusDiv.classList.remove('show'); }, 4000);
}
function updateButtons() {
  document.getElementById('stopBtn').disabled = !isStreaming;
}
</script>
</body>
</html>